<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard ‚Ä¢ Project KALMA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Sidebar toggle button */
        .sidebar-toggle {
            position: absolute;
            top: 12px;
            right: -18px;
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.15);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: 0.2s;
            z-index: 5;
        }
        .sidebar-toggle:hover {
            background: rgb(255, 255, 255);
        }

        .sidebar-full {
            width: 200px !important;
            flex-direction: column;
            align-items: flex-start;
            padding: 12px;
            transition: width 0.3s;
        }

        .sidebar-full .nav-btn {
            justify-content: flex-start;
            padding-left: 12px;
        }

        .sidebar-full .nav-btn span {
            margin-left: 12px;
            display: inline-block;
        }
    </style>
</head>
<body class="dashboard-bg">

<div class="app-shell">

    <!-- SIDEBAR -->
    <div id="sidebar" class="sidebar-min">
        <a href="/dashboard" class="nav-btn" title="Dashboard">üè†</a>
        <a href="/self_assessment" class="nav-btn" title="Self Assessment">üìä</a>
        <a href="/profile" class="nav-btn" title="Profile">üë§</a>
        <a href="/logout" class="nav-btn" title="Logout">üîì</a>
    </div>

    <!-- MAIN AREA -->
    <div class="main-area">
        <!-- Topbar -->
        <div class="topbar" style="justify-content: flex-start;">
          <div class="greeting" style="color: black;">Hello, {{ user }}!</div>
        </div>

    <!-- Motivational Quote -->
     {% if motivation %}
         <div class="motivation-pill" style="
            font-size: 1.4rem;
            padding: 15px 25px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            color: black;
            font-weight: 600;
            background: white;
            border-radius: 12px;
          ">
            {{ motivation['message'] }}
          </div>
      {% endif %}
    
        <!-- Stat Cards -->
        <div class="cards-row">
            <div class="stat-card">
                <h6>Total Tasks</h6>
                <div id="total-tasks" class="stat-big">0</div>
            </div>
            <div class="stat-card">
                <h6>Completed</h6>
                <div id="done-tasks" class="stat-big">0</div>
            </div>
            <div class="stat-card">
                <h6>Pending</h6>
                <div id="pending-tasks" class="stat-big">0</div>
            </div>
        </div>

        <!-- Task Board -->
        <div class="board">
            <!-- TASK LIST -->
            <div class="tasks-card">
                <h5>Your Tasks</h5>
                {% if tasks %}
                    {% for task in tasks %}
                        <div class="task-item">
                            <div>
                                <strong>{{ task['title'] }}</strong>
                                <div class="task-meta">
                                    {{ task['category'] }} | Due: {{ task['due_date'] }} 
                                    {% if task['is_completed'] %} ‚úÖ Completed {% endif %}
                                </div>
                            </div>
                            <div class="task-actions">
                                {% if not task['is_completed'] %}
                                    <a href="/complete_task/{{ task['id'] }}" class="btn btn-success btn-sm">‚úî</a>
                                {% endif %}
                                <a href="/edit_task/{{ task['id'] }}" class="btn btn-primary btn-sm">‚úé</a>
                                <a href="/delete_task/{{ task['id'] }}" class="btn btn-danger btn-sm">üóë</a>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>No tasks yet! Add one on the right panel.</p>
                {% endif %}
            </div>

            <!-- ADD TASK -->
            <div class="add-task-card">
                <h5>Add Task</h5>
                <form method="POST" action="/add_task">
                    <div class="mb-3">
                        <label>Title</label>
                        <input type="text" class="form-control" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label>Category</label>
                        <input type="text" class="form-control" name="category">
                    </div>
                    <div class="mb-3">
                        <label>Due Date</label>
                        <input type="date" class="form-control" name="due_date">
                    </div>
                    <button type="submit" class="btn btn-danger w-100">Add Task</button>
                </form>

                <!-- Donut Chart Below Add Task -->
                <div class="stat-card" style="margin-top: 18px; padding: 15px;">
                    <div style="position: relative; width: 100%; height: 0; padding-bottom: 100%;"></div>
                    <canvas id="tasksChart"style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
                </div>
              </div> <!-- END add-task-card -->

              </div> <!-- END board -->


<script>
    // Sidebar toggle
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('sidebar-full');
    }

    // Fetch stats and populate
    fetch('/api/task_stats')
        .then(res => res.json())
        .then(data => {
            document.getElementById('total-tasks').innerText = data.total;
            document.getElementById('done-tasks').innerText = data.done;
            document.getElementById('pending-tasks').innerText = data.pending;
        });

        <!-- Donut Chart Script -->

    // Fetch stats and populate
    fetch('/api/task_stats')
        .then(res => res.json())
        .then(data => {
            // Update stat cards
            document.getElementById('total-tasks').innerText = data.total;
            document.getElementById('done-tasks').innerText = data.done;
            document.getElementById('pending-tasks').innerText = data.pending;

            // Chart 
            const ctx = document.getElementById('tasksChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Pending'],
                    datasets: [{
                        data: [data.done, data.pending],
                        backgroundColor: ['#4CAF50', '#F44336'],
                        hoverOffset: 6
                    }]
                },
                options: {
                    maintainAspectRatio: false, // ensures it fits container
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: 'black', font: { family: 'Times New Roman', size: 14 } }
                        },
                        tooltip: {
                            bodyFont: { family: 'Times New Roman' }
                        }
                    }
                }
            });
        });
</script>

</body>
</html>
